<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’š ì˜¤ë¿¡ë¹µë‚¨ë¯¸ì˜ ì¿ í°ë¶ â¤ï¸</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
    --primary-accent: #FF6B6B;
    --secondary-accent: #4ECDC4;
    --background-light: #F8F8F8;
    --background-medium: #E8E8E8;
    --text-dark: #333333;
    --text-medium: #555555;
    --border-light: #CCCCCC;
    --danger-color: #E74C3C;
    
    --card-rotation-x: 0deg;
    --card-rotation-y: 0deg;
}

body { 
    font-family: 'Noto Sans KR', sans-serif; 
    background-color: var(--background-light); 
    margin: 0; 
    padding: 0; 
    color: var(--text-dark); 
}

body.is-locked {
    overflow: hidden;
}

.container { 
    max-width: 100%; 
    width: 100%; 
    box-sizing: border-box; 
    background-color: var(--background-light);
    min-height: 100vh; 
    padding: 20px; 
}
header { 
    text-align: center; 
    border-bottom: 2px dashed var(--primary-accent);
    padding-bottom: 15px; 
    margin-bottom: 20px; 
}
header h1 { 
    color: var(--primary-accent);
    margin: 0; 
}

.header-buttons {
    margin-top: 15px; display: flex; justify-content: center;
    gap: 10px; flex-wrap: wrap;
}
.header-buttons button {
    background: none; border-radius: 20px; padding: 8px 16px;
    font-size: 14px; cursor: pointer; 
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    font-family: 'Noto Sans KR', sans-serif; font-weight: bold;
}
#view-toggle-button { border: 1px solid var(--secondary-accent); color: var(--secondary-accent); }
#reset-button { border: 1px solid var(--danger-color); color: var(--danger-color); }
#data-view-button { border: 1px solid var(--primary-accent); color: var(--primary-accent); }
.header-buttons button:hover { background-color: var(--secondary-accent); color: var(--background-light); border-color: var(--secondary-accent); }
#reset-button:hover { background-color: var(--danger-color); color: var(--background-light); border-color: var(--danger-color); }
#data-view-button:hover { background-color: var(--primary-accent); color: var(--background-light); border-color: var(--primary-accent); }

.view { display: none; }
.view.is-active { display: block; }

.category-section { margin-bottom: 30px; }
.category-title { font-size: 1.8em; color: var(--primary-accent); margin-left: 15px; margin-bottom: 15px; }
.coupon-row { 
    display: flex; overflow-x: auto; padding: 10px; 
    scroll-snap-type: x mandatory; scrollbar-width: none; 
    -ms-overflow-style: none; 
}
.coupon-row::-webkit-scrollbar { display: none; }

.deck-section { margin-bottom: 25px; }
.deck-section-title { font-size: 1.2em; color: var(--text-dark); margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid var(--secondary-accent); }
.deck-row { display: flex; flex-wrap: wrap; gap: 10px; }
.deck-card { 
    width: 100px; aspect-ratio: 1 / 1.4; border-radius: 8px; 
    background: var(--background-medium); border: 1px solid var(--border-light);
    display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; 
    padding: 10px; box-sizing: border-box; font-size: 14px; font-weight: bold; 
    color: var(--text-dark); position: relative; overflow: hidden; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer; transition: transform 0.3s, box-shadow 0.3s;
}

/* ì¹´ë“œ ë³„ë¡œ ìƒ‰ìƒ íš¨ê³¼ ë¶€ë¶„ */
/* === ì¹´í…Œê³ ë¦¬ë³„ ë± ì¹´ë“œ ìƒ‰ìƒ ë§¤í•‘ === */
.deck-card {
  /* ê¸°ë³¸ê°’(ì¹´í…Œê³ ë¦¬ ë¯¸ë§¤í•‘ ì‹œ) */
  background: var(--deck-bg, var(--background-medium));
  border-color: var(--deck-border, var(--border-light));
  color: var(--deck-text, var(--text-dark));
}

/* ğŸ’– íŠ¹ë³„í•œ ë‚  : í•‘í¬ í†¤ */
.deck-card[data-category="ğŸ’– íŠ¹ë³„í•œ ë‚ "] {
  --deck-bg: #FDECEF;         /* ì•„ì£¼ ì˜…ì€ í•‘í¬ */
  --deck-border: #FF6B6B;     /* ë©”ì¸ í¬ì¸íŠ¸ */
  --deck-text: #7A2630;       /* ì§„í•œ ë¡œì¦ˆ */
}

/* ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨ : ë¯¼íŠ¸/í‹°ì—˜ í†¤ */
.deck-card[data-category="ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨"] {
  --deck-bg: #E9FBF8;         /* ì˜…ì€ ë¯¼íŠ¸ */
  --deck-border: #4ECDC4;     /* ë©”ì¸ í¬ì¸íŠ¸ */
  --deck-text: #1D5C57;       /* ì§™ì€ í‹¸ */
}

/* ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ : ë¼ì¼ë½/í¼í”Œ í†¤ */
.deck-card[data-category="ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ"] {
  --deck-bg: #F4EEFF;         /* ì˜…ì€ ë¼ì¼ë½ */
  --deck-border: #8E7CC3;     /* ë©”ì¸ í¼í”Œ */
  --deck-text: #4A3F73;       /* ë”¥ í¼í”Œ */
}

/* ğŸš¨ ê¸´ê¸‰ìƒí™© : ì˜ë¡œ/ë ˆë“œ ì›œ í†¤ */
.deck-card[data-category="ğŸš¨ ê¸´ê¸‰ìƒí™©"] {
  --deck-bg: #FFF4E5;         /* ì˜…ì€ í¬ë¦¼/ì˜¤ë Œì§€ */
  --deck-border: #E74C3C;     /* ê²½ê³  ë ˆë“œ */
  --deck-text: #7A2B24;       /* ë‹¤í¬ ë ˆë“œë¸Œë¼ìš´ */
}

/* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ ê°•ì¡° */
.deck-card:hover {
  border-color: var(--deck-border, var(--secondary-accent));
}

/* ì‚¬ìš©ì™„ë£Œ ì¹´ë“œ: ìƒ‰ íŒíŠ¸ëŠ” ë‚¨ê¸°ê³  ê°€ë…ì„± ìœ ì§€ */
.deck-card.used {
  filter: grayscale(40%) saturate(80%);
  opacity: 0.8;
}



.deck-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
.deck-card.used { 
    opacity: 0.7; filter: grayscale(60%); 
    background: linear-gradient(135deg, var(--background-medium), var(--border-light));
    color: var(--text-medium);
}
.deck-card.used::after { 
    content: 'USED'; position: absolute; top: 50%; left: 50%; 
    transform: translate(-50%, -50%) rotate(-20deg); font-size: 1.6em;
    font-weight: bold; color: rgba(0, 0, 0, 0.3); border: 2px solid rgba(0, 0, 0, 0.3);
    padding: 2px 8px; border-radius: 5px; background-color: rgba(255, 255, 255, 0.5);
}

.coupon { 
    flex-shrink: 0; width: 70vw; max-width: 250px;
    aspect-ratio: 250 / 350; margin: 0 2.5vw;
    cursor: pointer; position: relative; background-color: transparent; 
    perspective: 1000px; scroll-snap-align: center; 
    transform: rotateY(var(--card-rotation-y)) rotateX(var(--card-rotation-x)); 
    transform-origin: center center; border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

/* --- [ìµœì¢… ìˆ˜ì •] ì™„ë²½í•œ 3D ì¹´ë“œ ë’¤ì§‘ê¸°ë¥¼ ìœ„í•œ ìµœì¢… ì½”ë“œ --- */
.card-inner { 
    position: relative;
    width: 100%;
    height: 100%; 
    transition: transform 0.6s; 
    /* [í•µì‹¬] ìì‹ ìš”ì†Œë“¤ì´ 3D ê³µê°„ì— ì¡´ì¬í•˜ë„ë¡ ë§Œë“­ë‹ˆë‹¤. */
    transform-style: preserve-3d;
}

.card-inner.is-flipped { 
    transform: rotateY(180deg); 
}

.card-front, .card-back { 
    position: absolute;
    width: 100%;
    height: 100%; 
    /* [í•µì‹¬] ìš”ì†Œì˜ ë’·ë©´ì´ ë³´ì¼ ë•Œ íˆ¬ëª…í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. */
    backface-visibility: hidden; 
    -webkit-backface-visibility: hidden;
    border-radius: 15px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center; 
    text-align: center;
    padding: 20px;
    box-sizing: border-box; 
}

.card-front { 
    background: linear-gradient(135deg, var(--secondary-accent), var(--primary-accent));
    color: var(--background-light);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    /* ì•ë©´ì€ ì •ë©´ì„ ë³´ë„ë¡ ì„¤ì • */
    transform: rotateY(0deg);
}

.card-back { 
    background-color: var(--background-medium);
    /* ë’·ë©´ì€ ë¯¸ë¦¬ 180ë„ ë’¤ì§‘ì–´ ë†“ê¸° */
    transform: rotateY(180deg); 
}
/* --- 3D ì¹´ë“œ ë’¤ì§‘ê¸° ì½”ë“œ ë --- */

.card-front h3 { margin: 0; font-size: 1.8em; z-index: 1; }

.coupon.used .card-front::after {
    content: 'USED'; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%) rotate(-25deg); font-size: 3em;
    font-weight: bold; color: rgba(255, 255, 255, 0.3);
    border: 4px solid rgba(255, 255, 255, 0.3);
    padding: 5px 15px; border-radius: 10px; z-index: 2;
}

.card-back .card-close-button { 
    color: var(--text-medium); position: absolute; top: 10px; right: 20px; 
    font-size: 32px; font-weight: bold; cursor: pointer; 
    transition: color 0.3s;
}
.card-back .card-close-button:hover { color: var(--primary-accent); }
.card-back .use-coupon-button { 
    background-color: var(--primary-accent); color: var(--background-light);
    padding: 12px 25px; border: none; border-radius: 8px; 
    cursor: pointer; font-size: 17px;
    font-weight: bold; transition: background-color 0.3s, transform 0.2s;
}
.card-back .use-coupon-button:hover { 
    background-color: var(--danger-color); transform: translateY(-2px);
}

#overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background-color: rgba(0, 0, 0, 0.6);
    display: none; z-index: 99; opacity: 0; transition: opacity 0.5s; 
}
#overlay.is-active { display: block; opacity: 1; }

.modal { display: none; position: fixed; z-index: 101; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
.modal-content { 
    background-color: var(--background-medium); margin: 10% auto;
    padding: 25px; border: 1px solid var(--secondary-accent); 
    border-radius: 12px; width: 90%; max-width: 650px;
    position: relative; box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}
.modal-content .close-button { 
    color: var(--text-medium); position: absolute; top: 10px; right: 20px; 
    font-size: 32px; font-weight: bold; cursor: pointer; 
    transition: color 0.3s;
}
.modal-content .close-button:hover { color: var(--primary-accent); }
#data-json-output { 
    background-color: #222; color: var(--secondary-accent);
    padding: 18px; border-radius: 5px; height: 45vh;
    overflow-y: auto; white-space: pre-wrap; 
    word-wrap: break-word; font-size: 15px; 
}

/* --- íŒì—… ì• ë‹ˆë©”ì´ì…˜ ë° ë ˆì´ì•„ì›ƒ CSS --- */
.coupon.is-active {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 90vw;
    max-width: 400px;
    height: auto;
    max-height: 85vh;
    z-index: 100;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.7);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s;
    background: linear-gradient(135deg, var(--secondary-accent), var(--primary-accent));
}

.coupon.is-visible {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.coupon.is-active .card-front, .coupon.is-active .card-back {
    border: none;
}

.coupon.is-active .card-back {
    display: flex;
    flex-direction: column;
    padding: 25px 20px;
    box-sizing: border-box;
}

.coupon.is-active .card-back h2 {
    color: var(--primary-accent);
    font-size: clamp(1.4em, 6vw, 2em);
    font-weight: 700;
    margin: 0;
    line-height: 1.3;
}

.coupon.is-active .card-back p {
    color: var(--text-medium);
    font-size: clamp(0.9em, 4vw, 1.1em);
    margin-top: 15px;
    line-height: 1.6;
    word-break: keep-all;
}

.coupon.is-active .card-back .use-coupon-button,
.coupon.is-active .card-back .used-date {
    margin-top: auto;
    width: 100%;
    text-align: center;
}

.coupon.is-active .card-back .use-coupon-button {
    font-size: clamp(1em, 4.5vw, 1.1em);
    padding: 12px 20px;
    border-radius: 10px;
}

.coupon.is-active .card-back .used-date {
    color: var(--text-medium);
    font-size: 0.9em;
    padding-top: 15px;
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ’š ê¹€ë¿¡ë¹µì˜ ì¿ í°ë¶ â¤ï¸</h1>
            <p>ì‚¬ë‘í•˜ëŠ” ìê¸°ì—ê²Œ ì£¼ëŠ” ì„ ë¬¼</p>
            <div class="header-buttons">
                <button id="permission-button" style="display:none;">âœ¨ ìì´ë¡œ íš¨ê³¼ ì¼œê¸°</button>
                <button id="view-toggle-button">ì¿ í° ë± ë³´ê¸° ğŸ—‚ï¸</button>
                <button id="reset-button">ë°ì´í„° ì´ˆê¸°í™” â™»ï¸</button>
                <!--<button id="data-view-button">ë°ì´í„° ë³´ê¸° ğŸ“ˆ</button>-->
            </div>
        </header>

        <main id="category-view" class="view is-active"></main>
        <div id="deck-view" class="view"></div>
    </div>
    <div id="overlay"></div>

    <div id="data-modal" class="modal">
        <div class="modal-content">
            <span id="data-modal-close" class="close-button">&times;</span>
            <h2>ì¿ í° ë°ì´í„° (localStorage)</h2>
            <pre id="data-json-output"></pre>
        </div>
    </div>
    
<script>
  const allCoupons = [
    { category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ", title: "ì†Œì› ë“¤ì–´ì£¼ê¸°", description: "ìê¸°ì˜ ì†Œì› í•œ ê°€ì§€ë¥¼ ì •ì„±ê» ë“¤ì–´ì¤„ê²Œ â¤ï¸ ê·¸ëŸ¬ë‚˜ ì´ ì¿ í°ì„ ì‚¬ìš©í• ë•ŒëŠ” 'ì§„ì§œ ì„¸ìƒì—ì„œ ëŒ€ì–‘ì´ê°€ ì™„ì „ ëŒ€ë°• ìš¸íŠ¸ë¼ìº¡ìˆ‘ ì§±ì§± ê·¸ ëˆ„êµ¬ë³´ë‹¤ë„ ë©‹ì§€ê³  ì˜ìƒê¸°ê³  ìš°ì£¼ì§±ì§± í›ˆë‚¨ì— ë‹¤ì •í•˜ê¸°ê¹Œì§€ í•˜ê³  í•­ìƒ ë‚˜ ë¨¼ì € ìƒê°í•´ì£¼ê³  ì§±êµ¬ê°™ì€ ì·¨ë¯¸ë„ í•­ìƒ ê°™ì´ í•´ì£¼ê³  ìƒê¸´ê±°ëŠ” ì•½ê°„ ë¶€ë¦¬ë¶€ë¦¬ëŒ€ë§ˆì™• ê°™ì•„ê°€ì§€ê³  ì™„ì „ ìƒìœ„ í˜¸í™˜ì— ìš”ë¦¬ê¹Œì§€ ì˜í•˜ë©´ ì–´ì©ŒìëŠ”ê±´ì§€ ì§„ì§œ ëª»í•˜ëŠ”ê²Œ ì—†ê³  ì¬ë°Œê¸°ê¹Œì§€ í•œ ëŒ€ì–‘ì´ê°€ ë­!!>!!??!!??!!! ì†Œì›ê¹Œì§€ ë“¤ì–´ì¤€ë‹¤ê³ ~!!!~>>!!>!>! í•˜ ê·¸ëƒ¥ ë‚˜ ì˜¤ëŠ˜ ì£½ì„ê²Œ ã… ã…  ë‚œ ì—¬ê¸°ì„œ ì£½ì–´ë„ ì§„ì§œ ì—¬í•œì´ ì—†ë‹¤. ê·¸ë˜ë„ ì£½ê¸° ì „ì— ëŒ€ì–‘ì´ê°€ ì†Œì› ì´ë¤„ì¤€ë‹¤ëŠ”ë° í•œ ë²ˆ ë³´ê³ ëŠ” ê°€ì•¼ì§€. ëŒ€ì–‘ë‹˜~~~ ì†Œì› ë“¤ì–´ì£¼ì„¸ìš”~~~' ë¼ê³ ë¼ê³  ë§í•˜ê¸° ã…‹", image: null, used: false, used_date: null },
    { category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ", title: "1ì¼ ììœ ì´ìš©ê¶Œ", description: "ì˜¤ëŠ˜ í•˜ë£¨ ìê¸°ê°€ í•˜ê³  ì‹¶ì€ ê±° ë‹¤ í•´! ë‚˜ ê°€ì§€ê³  ë§‰ ì‚¬ìš©í•´ë„ë¼ í•˜ì§€ë§Œ ì´ë ‡ê²Œ ê·€ì—¬ìš´ ëŒ€ì–‘ì´ë¥¼ ã… ã…  ë§‰ ë‹¤ë£¨ì§€ëŠ” ì•Šê² ì§•~~~!?", image: null, used: false, used_date: null },
    { category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ", title: "ì¶”ì–µì˜ ì¥ì†Œ í•¨ê»˜ ê°€ê¸°", description: "ìš°ë¦¬ì˜ ì²« ë§Œë‚¨, ì²« ë°ì´íŠ¸ ì¥ì†Œì²˜ëŸ¼ íŠ¹ë³„í•œ ì˜ë¯¸ê°€ ìˆëŠ” ê³³ì— í•¨ê»˜ ê°ˆê²Œ. ê·¸ë‚ ì˜ ì„¤ë ˜ì„ ë‹¤ì‹œ ëŠê»´ë³´ìì‡!!", image: null, used: false, used_date: null},
     {category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ",title: "í™ˆ ìŠ¤íŒŒ ë°ì´",description: "ì¡±ìš•+í•«íŒ©+ì–´ê¹¨ë§ˆì‚¬ì§€+í‹° ì„¸íŠ¸ë¡œ ì§‘ì—ì„œ ìŠ¤íŒŒì²˜ëŸ¼ íë§ì‹œì¼œì£¼ëŠ” í™ˆí…Œë¼í”¼ìŠ¤íŒŒìŠ¤íŒŒíë§ì „ë¬¸ê°€ ìê²©ì¦ ë³´ìœ í•œ ë‚˜",image: null,used: false, used_date: null},
     {category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ",title: "ì„¸ìƒì— ë‹¨ í•˜ë‚˜ë¿ì¸ í¸ì§€",description: "í‰ì†Œì— ëª»í–ˆë˜ ë§ë“¤ì„ ê¾¹ê¾¹ ëˆŒëŸ¬ ë‹´ì•„, ì„¸ìƒì—ì„œ ê°€ì¥ íŠ¹ë³„í•œ ì†í¸ì§€ë¥¼ ì¨ì¤„ê²Œ. ê·¼ë° ë‚˜ ì•…í•„ì´ë¼ ã…ã… ì•„ì‰ ì•„ë¬´íŠ¼ ì´ê±° ì‚¬ìš©ì‹œ ëŒ€ëµ ì¼ì£¼ì¼ ì†Œìš” ë  ìˆ˜ ìˆì–´ìš©",image: null,used: false,used_date: null},
     {category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ",title: "ì»¤í”Œ ì‚¬ì§„ ì´¬ì˜ê¶Œ",description: "ì‚¼ê°ëŒ€ ë†“ê³  ìš°ë¦¬ë¼ë¦¬ ì°ëŠ” ì…€í”„ ìŠ¤ëƒ…ì‚¬ì§„! í‰ìƒ ê°„ì§í•  ì˜ˆìœ ì¶”ì–µì„ ë§Œë“¤ì. ì¸ìƒë„¤ì»· ã…ã… ",image: null,used: false,used_date: null},
     {    category: "ğŸ’– íŠ¹ë³„í•œ ë‚ ",    title: "ìƒˆë¡œìš´ ì·¨ë¯¸ 1ì¼ ì²´í—˜ê¶Œ",    description: "ì„œë¡œì—ê²Œ ê°€ë¥´ì³ì£¼ê³  ì‹¶ì—ˆê±°ë‚˜, í•¨ê»˜ ë°°ì›Œë³´ê³  ì‹¶ì—ˆë˜ ìƒˆë¡œìš´ ë¶„ì•¼ì— ë„ì „í•˜ëŠ” ë‚ ! (ex. ë² ì´í‚¹ í´ë˜ìŠ¤, ì•”ë²½ ë“±ë°˜, ëŒ„ìŠ¤ ë°°ìš°ê¸°)",    image: null,    used: false,    used_date: null  },
    { category: "ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨", title: "ìµœê³ ê¸‰ ì €ë… ì‹ì‚¬", description: "ìì..! ë§ë§Œí•´ ìš°ë¦¬ ì• ê¹… ë­ ë¨¹ê³  ì‹¶ì–´?? ã…ã…", image: null, used: false, used_date: null },
     {category: "ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨",title: "1ì¸ ì…°í”„ ë””ë„ˆ",description: "ë‚œ ë‹¹ì‹ ë§Œì˜ ì§œíŒŒê²Œí‹° ìš”ë¦¬ì‚¬~  ë‚´ê°€ ì§ì ‘í•´ì£¼ëŠ” ì €ë… ì‹ì‚¬~!",image: null,used: false, used_date: null},
   {category: "ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨",title: "ì•¼ì‹ ë©´ì±…ê¶Œ",description: "ë°¤ 11ì‹œ ì´í›„ì—ë„ ì£„ì±…ê° Zero! ë¨¹ê³  ì‹¶ì€ ì•¼ì‹ ë°”ë¡œ ê³ !",image: null,used: false, used_date: null},
    { category: "ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨", title: "ì„¸ìƒì—ì„œ ê°€ì¥ ë§›ìˆëŠ” ìˆ ", description: "ê·¸ê²ƒì€ ë°”ë¡œ ë‚´ ì…ìˆ ~ ìœ í›„~~~ğŸ˜˜\n ë½€ë½€ 119912364909ë²ˆ í•´ì£¼ê¸°", image: null, used: false, used_date: null },
    { category: "ğŸ½ï¸ ë§›ìˆëŠ” í•˜ë£¨", title: "ì¹˜í‚¨ & ë§¥ì£¼", description: "ì˜¤ëŠ˜ ë°¤ì€ ì¹˜ë§¥ì´ë‹¤! ğŸ—ğŸº ì´ê±´ ì§„ì§œ ëª» ì°¸ì§€ ", image: null, used: false, used_date: null },
    { category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ", title: "ì•ˆë§ˆ 30ë¶„", description: "í”¼ê³¤í•œ ìê¸°ë¥¼ ìœ„í•´ ì‚¬ë‘ì„ ë‹´ì•„ ì•ˆë§ˆí•´ì¤„ê²Œ! ì¢…ì•„ë¦¬ ë§ì´ ì•„í”„ì§•? ã… ã…  ì¼ë£¨ì™€ ã…ã…", image: null, used: false, used_date: null },
    { category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ", title: "ì˜í™”ê´€ ë°ì´íŠ¸", description: "ë³´ê³  ì‹¶ì€ ì˜í™” ê°™ì´ ë³´ëŸ¬ ê°€ì! ë‚œ í•­ìƒ ìê¸°ì™€ ì˜í™” ë³´ê¸° ì „ì´ ë„ˆë¬´ ì„¤ë ˆëŠ”ê±° ê°™ì•„... ì˜›ë‚  ìƒê° ë‚˜ê¸°ë„ í•˜ê³  ã…ã… ìš°ë¦¬í•œí…Œ ì˜í™”ê´€ì€ ì¢€ íŠ¹ë³„í• ì§€ë„!!?", image: null, used: false, used_date: null },
    { category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ", title: "ë¬´ì¡°ê±´ ì¹­ì°¬ 30ë¶„", description: "ë¬´ìŠ¨ ë§ì´ í•„ìš”í•´ ë„Œ ê·¸ëƒ¥ ì¹­ì°¬ ë¡œë´‡ì´ë¼êµ¬..! ì˜¤PT ì¶œê²©", image: null, used: false, used_date: null },
    {    category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ",    title: "ê³ ë¯¼ ìƒë‹´ì†Œ ì´ìš©ê¶Œ",    description: "ë‹µë‹µí•˜ê³  í˜ë“  ì¼ ìˆì„ ë•Œ, ë¬´ì¡°ê±´ ìê¸° í¸ì´ ë˜ì–´ì„œ ëê¹Œì§€ ë“¤ì–´ì£¼ê³  ê³µê°í•´ì¤„ê²Œ. ì–¸ì œë“  ë§í•´ ã…ã…. ë­”ê°€ ë§í•˜ê¸° ì–´ë ¤ìš¸ ë•Œ ìˆì–ì•„. ê·¸ëŸ´ë–„ ë‚´ê°€ ìê¸°ê°€ ê¸°ëŒˆ ìˆ˜ ìˆëŠ” ê±°ëŒ€í•œ ê°ìê°€ ë˜ì–´ì¤„ê²Œ ã…ã…",    image: null,    used: false,    used_date: null  },
    {    category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ",    title: "ì‹¬ë¶€ë¦„ 1+1 ì¿ í°",    description: "ê·€ì°®ì€ ì‹¬ë¶€ë¦„, í•œ ë²ˆì— ë‘ ê°€ì§€ê¹Œì§€ êµ°ë§ ì—†ì´ í•´ì¤„ê²Œ! ì§‘ì²­ì†Œ!! í™”ì¥ì‹¤ ì²­ì†Œ!~!! ë˜¥í†µ ì¹˜ìš°ê¸°!!@@! ë§ë§Œí•´!!",    image: null,    used: false,    used_date: null  },
    {    category: "ğŸ’‘ ì†Œì†Œí•œ í–‰ë³µ",    title: "ì›í•˜ëŠ” ì• ì¹­ìœ¼ë¡œ ë¶ˆëŸ¬ì£¼ê¸°",    description: "í•˜ë£¨ ë™ì•ˆ ìê¸°ê°€ ì›í•˜ëŠ” ë‹­ì‚´ ë‹ëŠ” ì• ì¹­ì´ë¼ë„ ë¶€ë„ëŸ¬ì›Œí•˜ì§€ ì•Šê³  ê³„ì† ë¶ˆëŸ¬ì¤„ê²Œ. ê³µì£¼ë‹˜? ì™•ìë‹˜? â¤ï¸",    image: null,    used: false,    used_date: null  },
    { category: "ğŸš¨ ê¸´ê¸‰ìƒí™©", title: "í™” í’€ì–´ì£¼ê¸°", description: "ë‚´ê°€ ì˜ëª»í–ˆì„ ë•Œ ë³´ì—¬ì£¼ë©´ ë¬´ì¡°ê±´ ì‚¬ê³¼í• ê²Œ ğŸ™ ã… ã…  ê·¸ë¦¬ê³  ìš°ë¦¬ ì• ê¹… í™”ë„ í’€ì–´ì¤„ê²Œ, ë°˜ëŒ€ë¡œ ë‚´ê°€ í™”ë‚¬ì„ë•Œë„ ì‚¬ìš© ê°€ëŠ¥í•´!!", image: null, used: false, used_date: null },
  {    category: "ğŸš¨ ê¸´ê¸‰ìƒí™©",    title: "ë¬»ì§€ë„ ë”°ì§€ì§€ë„ ì•Šê³  ë‚´ í¸ ë˜ê¸°",    description: "ì–µìš¸í•œ ì¼, ì†ìƒí•œ ì¼ ìˆì„ ë•Œ ì´ìœ  ë¬»ì§€ ì•Šê³  ë¬´ì¡°ê±´ ë„¤ í¸ì´ ë˜ì–´ì¤„ê²Œ.",    image:null,    used: false,    used_date: null  },
  {    category: "ğŸš¨ ê¸´ê¸‰ìƒí™©",    title: "ê¸´ê¸‰ í˜¸ì¶œ",    description: "ì§€ê¸ˆ ë‹¹ì¥ ì˜†ìœ¼ë¡œ ì™€ì¤˜ì•¼ í•  ë•Œ, ì•„ë¬´ë¦¬ ë°”ë¹ ë„ ë¬´ì¡°ê±´ ë‹¬ë ¤ê°ˆê²Œ!",    image: null,    used: false,    used_date: null  }, 
  {    category: "ğŸš¨ ê¸´ê¸‰ìƒí™©",    title: "ì‚¬ê³¼ ìš°ì„ ê¶Œ",    description: "ë§ê³  í‹€ë¦¼ë³´ë‹¤ ê´€ê³„ê°€ ë¨¼ì €. ì œê°€ ë¨¼ì € ì‚¬ê³¼í•˜ê³ , ì„œë¡œ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê¸°~",    image: null,    used: false, used_date: null  },
  {    category: "ğŸš¨ ê¸´ê¸‰ìƒí™©",    title: "PK ì‹¬íŒì",    description: "í•˜ ì´ê²Œ ë§ì•„? ì´ê²Œ ë§ëƒêµ¬!! ì´ëŸ»ë•Œ ìˆì§€ ì•Šì•„? ë‚´ê°€ ì§€ê¸ˆ ì˜³ì€ ì„ íƒì„ í•˜ê³  ìˆë‚˜? ê·¸ëŸ´ë•Œ ë‚´ê°€ ê°™ì´ ê³ ë¯¼ í•´ì¤„ê²œ ã…ã… ",image: null,    used: false, used_date: null  }
  ];

  let coupons = [];
  const categoryView = document.getElementById('category-view');
  const deckView = document.getElementById('deck-view');
  const viewToggleButton = document.getElementById('view-toggle-button');
  const overlay = document.getElementById('overlay');
  const permissionButton = document.getElementById('permission-button');
  const resetButton = document.getElementById('reset-button');
  const dataViewButton = document.getElementById('data-view-button');
  const dataModal = document.getElementById('data-modal');
  const dataModalClose = document.getElementById('data-modal-close');
  const dataJsonOutput = document.getElementById('data-json-output');

  function saveCoupons(couponsData) {
    localStorage.setItem('ourCouponData', JSON.stringify(couponsData));
  }

  // ì•ˆì „ ê°€ë“œ ì¶”ê°€(íŒŒì‹± ì˜¤ë¥˜/ë ˆê±°ì‹œ ë°ì´í„° ìë™ ë³µêµ¬)
  function loadCoupons() {
    const savedData = localStorage.getItem('ourCouponData');
    if (savedData) {
      try {
        return JSON.parse(savedData);
      } catch (e) {
        console.warn('ì €ì¥ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜ â†’ ì´ˆê¸° ë°ì´í„°ë¡œ ë³µêµ¬í•©ë‹ˆë‹¤.', e);
        localStorage.removeItem('ourCouponData');
      }
    }
    saveCoupons(allCoupons);
    return allCoupons;
  }

  function renderCategoryView() {
    categoryView.innerHTML = '';
    const categories = [...new Set(coupons.map(c => c.category))];

    categories.forEach(category => {
      const categorySection = document.createElement('div');
      categorySection.classList.add('category-section');

      const categoryTitle = document.createElement('h2');
      categoryTitle.classList.add('category-title');
      categoryTitle.textContent = category;
      categorySection.appendChild(categoryTitle);

      const couponRow = document.createElement('div');
      couponRow.classList.add('coupon-row');

      coupons.filter(c => c.category === category).forEach(coupon => {
        const couponDiv = document.createElement('div');
        couponDiv.classList.add('coupon');
        couponDiv.dataset.couponTitle = coupon.title;
        if (coupon.used) couponDiv.classList.add('used');

        const cardInner = document.createElement('div');
        cardInner.classList.add('card-inner');

        const cardFront = document.createElement('div');
        cardFront.classList.add('card-front');
        const title = document.createElement('h3');
        title.textContent = coupon.title;
        cardFront.appendChild(title);

        const cardBack = document.createElement('div');
        cardBack.classList.add('card-back');

        const closeButton = document.createElement('span');
        closeButton.classList.add('card-close-button');
        closeButton.innerHTML = '&times;';
        closeButton.addEventListener('click', (e) => { e.stopPropagation(); closeActiveCard(); });
        cardBack.appendChild(closeButton);

        const contentWrapper = document.createElement('div');
        const backTitle = document.createElement('h2');
        backTitle.textContent = coupon.title;
        const backDesc = document.createElement('p');
        backDesc.textContent = coupon.description;
        contentWrapper.appendChild(backTitle);
        contentWrapper.appendChild(backDesc);
        cardBack.appendChild(contentWrapper);

        if (coupon.used) {
          if (coupon.used_date) {
            const usedDateText = document.createElement('p');
            usedDateText.classList.add('used-date');
            const usedDate = new Date(coupon.used_date);
            const formattedDate = `${usedDate.getFullYear()}ë…„ ${usedDate.getMonth() + 1}ì›” ${usedDate.getDate()}ì¼ ${usedDate.getHours()}ì‹œ ${usedDate.getMinutes()}ë¶„`;
            usedDateText.textContent = `ì‚¬ìš© ì™„ë£Œ: ${formattedDate}`;
            cardBack.appendChild(usedDateText);
          }
        } else {
          const useButton = document.createElement('button');
          useButton.classList.add('use-coupon-button');
          useButton.textContent = 'ì¿ í° ì‚¬ìš©í•˜ê¸°';
          useButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm("ì •ë§ë¡œ ì´ ì¿ í°ì„ ì‚¬ìš©í•˜ì‹œê² ì–´ìš”?")) {
              const index = coupons.findIndex(c => c.title === coupon.title);
              if (index !== -1) {
                coupons[index].used = true;
                coupons[index].used_date = new Date().toISOString();
                saveCoupons(coupons);
                closeActiveCard(true);
              }
            }
          });
          cardBack.appendChild(useButton);
        }

        cardInner.appendChild(cardFront);
        cardInner.appendChild(cardBack);
        couponDiv.appendChild(cardInner);
        couponRow.appendChild(couponDiv);
      });
      categorySection.appendChild(couponRow);
      categoryView.appendChild(categorySection);
    });
  }

  function renderDeckView() {
    deckView.innerHTML = '';
    const availableSection = document.createElement('div');
    availableSection.classList.add('deck-section');
    const availableTitle = document.createElement('h3');
    availableTitle.classList.add('deck-section-title');
    availableTitle.textContent = 'ì‚¬ìš© ê°€ëŠ¥ ì¿ í°';
    const availableRow = document.createElement('div');
    availableRow.classList.add('deck-row');
    coupons.filter(c => !c.used).forEach(coupon => {
      const card = document.createElement('div');
      card.classList.add('deck-card');
      card.dataset.couponTitle = coupon.title;
      card.dataset.category = coupon.category; // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì†ì„± ì¶”ê°€, ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ìƒ‰ìƒì„ ìœ„í•œ ì¶”ê°€ ì½”ë“œ 1ì¤‘

      const cardTitle = document.createElement('span');
      cardTitle.textContent = coupon.title;
      card.appendChild(cardTitle);

      availableRow.appendChild(card);
    });
    availableSection.appendChild(availableTitle);
    availableSection.appendChild(availableRow);
    deckView.appendChild(availableSection);

    const usedCoupons = coupons.filter(c => c.used);
    if (usedCoupons.length > 0) {
      const usedSection = document.createElement('div');
      usedSection.classList.add('deck-section');
      const usedTitle = document.createElement('h3');
      usedTitle.classList.add('deck-section-title');
      usedTitle.textContent = 'ì‚¬ìš© ì™„ë£Œ ì¿ í°';
      const usedRow = document.createElement('div');
      usedRow.classList.add('deck-row');
      usedCoupons.forEach(coupon => {
        const card = document.createElement('div');
        card.classList.add('deck-card', 'used');
        card.dataset.couponTitle = coupon.title;
        card.dataset.category = coupon.category;    // ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ìƒ‰ìƒ ì„ ìœ„í•´ ì¶”ê°€í•œ ì½”ë“œ

        const cardTitle = document.createElement('span');
        cardTitle.textContent = coupon.title;
        const usedDateText = document.createElement('small');
        if (coupon.used_date) {
          const usedDate = new Date(coupon.used_date);
          usedDateText.textContent = `ì‚¬ìš©: ${usedDate.getMonth() + 1}/${usedDate.getDate()}`;
        }
        card.appendChild(cardTitle);
        card.appendChild(usedDateText);

        usedRow.appendChild(card);
      });
      usedSection.appendChild(usedTitle);
      usedSection.appendChild(usedRow);
      deckView.appendChild(usedSection);
    }
  }

  function openCard(cardElement) {
    if (document.querySelector('.coupon.is-active')) return;

    document.body.classList.add('is-locked');
    overlay.classList.add('is-active');

    cardElement.classList.add('is-active');

    const cardInner = cardElement.querySelector('.card-inner');
    const isUsed = cardElement.classList.contains('used');

    // ê°•ì œ ìƒ‰ìƒ ë³´ì •
    const cardBack = cardElement.querySelector('.card-back');
    if (cardBack) {
      const title = cardBack.querySelector('h2');
      const paragraphs = cardBack.querySelectorAll('p');

      if (title) title.style.color = 'var(--primary-accent)';
      paragraphs.forEach(p => { p.style.color = 'var(--text-medium)'; });
    }

    if (isUsed) {
      cardInner.style.transition = 'none';
      cardInner.classList.add('is-flipped');
      setTimeout(() => { cardInner.style.transition = ''; }, 0);
    } else {
      cardInner.classList.add('is-flipped');
    }

    setTimeout(() => {
      cardElement.classList.add('is-visible');
    }, 50);
  }

  function closeActiveCard(shouldRefresh = false) {
    const activeCard = document.querySelector('.coupon.is-active');
    if (activeCard) {
      activeCard.classList.remove('is-visible');

      setTimeout(() => {
        document.body.classList.remove('is-locked');
        overlay.classList.remove('is-active');

        activeCard.classList.remove('is-active');

        const cardInner = activeCard.querySelector('.card-inner');
        if (cardInner) {
          cardInner.classList.remove('is-flipped');
        }

        if (shouldRefresh) {
          if (categoryView.classList.contains('is-active')) renderCategoryView();
          if (deckView.classList.contains('is-active')) renderDeckView();
        }
      }, 400);
    }
  }

  function handleOrientation(event) {
    const { beta, gamma } = event;
    const rotateX = (beta - 45) * 0.3;
    const rotateY = gamma * 0.3;
    // ë³€ìˆ˜ëª… ì¶©ëŒ ë°©ì§€(ì „ì—­ allCouponsì™€ ë‹¤ë¥¸ ì´ë¦„ ì‚¬ìš©)
    const couponEls = document.querySelectorAll('.coupon:not(.is-active)');
    couponEls.forEach(coupon => {
      coupon.style.setProperty('--card-rotation-x', `${rotateX}deg`);
      coupon.style.setProperty('--card-rotation-y', `${rotateY}deg`);
    });
  }

  function initializeApp() {
    coupons = loadCoupons();
    // console.log('ì¿ í° ë¡œë“œë¨:', coupons);
    renderCategoryView();

    viewToggleButton.addEventListener('click', () => {
      const isCategoryViewActive = categoryView.classList.contains('is-active');
      if (isCategoryViewActive) {
        categoryView.classList.remove('is-active');
        deckView.classList.add('is-active');
        viewToggleButton.innerHTML = 'ì¹´í…Œê³ ë¦¬ ë³´ê¸° ğŸ“–';
        renderDeckView();
      } else {
        deckView.classList.remove('is-active');
        categoryView.classList.add('is-active');
        viewToggleButton.innerHTML = 'ì¿ í° ë± ë³´ê¸° ğŸ—‚ï¸';
        renderCategoryView();
      }
    });

    resetButton.addEventListener('click', () => {
      if (confirm("ì •ë§ë¡œ ëª¨ë“  ì¿ í° ë°ì´í„°ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ì–´ìš”? ì‚¬ìš© ê¸°ë¡ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) {
        localStorage.removeItem('ourCouponData');
        location.reload();
      }
    });

    dataViewButton.addEventListener('click', () => {
      const currentData = localStorage.getItem('ourCouponData');
      if (currentData) {
        const prettyJson = JSON.stringify(JSON.parse(currentData), null, 2);
        dataJsonOutput.textContent = prettyJson;
      } else {
        dataJsonOutput.textContent = "ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
      }
      dataModal.style.display = 'block';
    });

    dataModalClose.addEventListener('click', () => { dataModal.style.display = 'none'; });

    window.addEventListener('click', (event) => {
      if (event.target == dataModal) {
        dataModal.style.display = 'none';
      }
    });

    overlay.addEventListener('click', closeActiveCard);

    categoryView.addEventListener('click', (event) => {
      const couponDiv = event.target.closest('.coupon');
      if (couponDiv && !couponDiv.classList.contains('is-active')) {
        openCard(couponDiv);
      }
    });

    deckView.addEventListener('click', (event) => {
      const deckCard = event.target.closest('.deck-card');
      if (deckCard) {
        const title = deckCard.dataset.couponTitle;
        if (!categoryView.classList.contains('is-active')) {
          deckView.classList.remove('is-active');
          categoryView.classList.add('is-active');
          viewToggleButton.innerHTML = 'ì¿ í° ë± ë³´ê¸° ğŸ—‚ï¸';
          renderCategoryView();
        }

        setTimeout(() => {
          const correspondingCoupon = categoryView.querySelector(`.coupon[data-coupon-title="${title}"]`);
          if (correspondingCoupon) {
            correspondingCoupon.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
            setTimeout(() => openCard(correspondingCoupon), 500);
          }
        }, 100);
      }
    });

    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      permissionButton.style.display = 'block';
      permissionButton.addEventListener('click', () => {
        DeviceOrientationEvent.requestPermission().then(state => {
          if (state === 'granted') {
            window.addEventListener('deviceorientation', handleOrientation);
            permissionButton.style.display = 'none';
          } else {
            alert('ìì´ë¡œìŠ¤ì½”í”„ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        }).catch(console.error);
      });
    } else if ('DeviceOrientationEvent' in window) {
      window.addEventListener('deviceorientation', handleOrientation);
    }
  }

  document.addEventListener('DOMContentLoaded', initializeApp);
</script>

</body>

</html>
